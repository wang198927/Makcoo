(function($){var settings={},roots={},caches={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:true,showTitle:true,txtSelectedEnable:false},data:{key:{children:"children",name:"name",title:"",url:"url"},simpleData:{enable:false,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:false,leaf:false}},async:{enable:false,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(e){var t=data.getRoot(e);if(!t){t={};data.setRoot(e,t)}t[e.data.key.children]=[];t.expandTriggerFlag=false;t.curSelectedList=[];t.noSelection=true;t.createdNodes=[];t.zId=0;t._ver=(new Date).getTime()},_initCache=function(e){var t=data.getCache(e);if(!t){t={};data.setCache(e,t)}t.nodes=[];t.doms=[]},_bindEvent=function(e){var t=e.treeObj,n=consts.event;t.bind(n.NODECREATED,function(t,n,a){tools.apply(e.callback.onNodeCreated,[t,n,a])});t.bind(n.CLICK,function(t,n,a,o,r){tools.apply(e.callback.onClick,[n,a,o,r])});t.bind(n.EXPAND,function(t,n,a){tools.apply(e.callback.onExpand,[t,n,a])});t.bind(n.COLLAPSE,function(t,n,a){tools.apply(e.callback.onCollapse,[t,n,a])});t.bind(n.ASYNC_SUCCESS,function(t,n,a,o){tools.apply(e.callback.onAsyncSuccess,[t,n,a,o])});t.bind(n.ASYNC_ERROR,function(t,n,a,o,r,i){tools.apply(e.callback.onAsyncError,[t,n,a,o,r,i])});t.bind(n.REMOVE,function(t,n,a){tools.apply(e.callback.onRemove,[t,n,a])})},_unbindEvent=function(e){var t=e.treeObj,n=consts.event;t.unbind(n.NODECREATED).unbind(n.CLICK).unbind(n.EXPAND).unbind(n.COLLAPSE).unbind(n.ASYNC_SUCCESS).unbind(n.ASYNC_ERROR).unbind(n.REMOVE)},_eventProxy=function(e){var t=e.target,n=data.getSetting(e.data.treeId),a="",o=null,r="",i="",s=null,l=null,d=null;if(tools.eqs(e.type,"mousedown")){i="mousedown"}else if(tools.eqs(e.type,"mouseup")){i="mouseup"}else if(tools.eqs(e.type,"contextmenu")){i="contextmenu"}else if(tools.eqs(e.type,"click")){if(tools.eqs(t.tagName,"span")&&t.getAttribute("treeNode"+consts.id.SWITCH)!==null){a=tools.getNodeMainDom(t).id;r="switchNode"}else{d=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(d){a=tools.getNodeMainDom(d).id;r="clickNode"}}}else if(tools.eqs(e.type,"dblclick")){i="dblclick";d=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(d){a=tools.getNodeMainDom(d).id;r="switchNode"}}if(i.length>0&&a.length==0){d=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(d){a=tools.getNodeMainDom(d).id}}if(a.length>0){o=data.getNodeCache(n,a);switch(r){case"switchNode":if(!o.isParent){r=""}else if(tools.eqs(e.type,"click")||tools.eqs(e.type,"dblclick")&&tools.apply(n.view.dblClickExpand,[n.treeId,o],n.view.dblClickExpand)){s=handler.onSwitchNode}else{r=""}break;case"clickNode":s=handler.onClickNode;break}}switch(i){case"mousedown":l=handler.onZTreeMousedown;break;case"mouseup":l=handler.onZTreeMouseup;break;case"dblclick":l=handler.onZTreeDblclick;break;case"contextmenu":l=handler.onZTreeContextmenu;break}var c={stop:false,node:o,nodeEventType:r,nodeEventCallback:s,treeEventType:i,treeEventCallback:l};return c},_initNode=function(e,t,n,a,o,r,i){if(!n)return;var s=data.getRoot(e),l=e.data.key.children;n.level=t;n.tId=e.treeId+"_"+ ++s.zId;n.parentTId=a?a.tId:null;n.open=typeof n.open=="string"?tools.eqs(n.open,"true"):!!n.open;if(n[l]&&n[l].length>0){n.isParent=true;n.zAsync=true}else{n.isParent=typeof n.isParent=="string"?tools.eqs(n.isParent,"true"):!!n.isParent;n.open=n.isParent&&!e.async.enable?n.open:false;n.zAsync=!n.isParent}n.isFirstNode=o;n.isLastNode=r;n.getParentNode=function(){return data.getNodeCache(e,n.parentTId)};n.getPreNode=function(){return data.getPreNode(e,n)};n.getNextNode=function(){return data.getNextNode(e,n)};n.isAjaxing=false;data.fixPIdKeyValue(e,n)},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(e,t){data.getCache(e).nodes[data.getNodeCacheId(t.tId)]=t},getNodeCacheId:function(e){return e.substring(e.lastIndexOf("_")+1)},addAfterA:function(e){_init.afterA.push(e)},addBeforeA:function(e){_init.beforeA.push(e)},addInnerAfterA:function(e){_init.innerAfterA.push(e)},addInnerBeforeA:function(e){_init.innerBeforeA.push(e)},addInitBind:function(e){_init.bind.push(e)},addInitUnBind:function(e){_init.unbind.push(e)},addInitCache:function(e){_init.caches.push(e)},addInitNode:function(e){_init.nodes.push(e)},addInitProxy:function(e,t){if(!!t){_init.proxys.splice(0,0,e)}else{_init.proxys.push(e)}},addInitRoot:function(e){_init.roots.push(e)},addNodesData:function(e,t,n){var a=e.data.key.children;if(!t[a])t[a]=[];if(t[a].length>0){t[a][t[a].length-1].isLastNode=false;view.setNodeLineIcos(e,t[a][t[a].length-1])}t.isParent=true;t[a]=t[a].concat(n)},addSelectedNode:function(e,t){var n=data.getRoot(e);if(!data.isSelectedNode(e,t)){n.curSelectedList.push(t)}},addCreatedNode:function(e,t){if(!!e.callback.onNodeCreated||!!e.view.addDiyDom){var n=data.getRoot(e);n.createdNodes.push(t)}},addZTreeTools:function(e){_init.zTreeTools.push(e)},exSetting:function(e){$.extend(true,_setting,e)},fixPIdKeyValue:function(e,t){if(e.data.simpleData.enable){t[e.data.simpleData.pIdKey]=t.parentTId?t.getParentNode()[e.data.simpleData.idKey]:e.data.simpleData.rootPId}},getAfterA:function(e,t,n){for(var a=0,o=_init.afterA.length;a<o;a++){_init.afterA[a].apply(this,arguments)}},getBeforeA:function(e,t,n){for(var a=0,o=_init.beforeA.length;a<o;a++){_init.beforeA[a].apply(this,arguments)}},getInnerAfterA:function(e,t,n){for(var a=0,o=_init.innerAfterA.length;a<o;a++){_init.innerAfterA[a].apply(this,arguments)}},getInnerBeforeA:function(e,t,n){for(var a=0,o=_init.innerBeforeA.length;a<o;a++){_init.innerBeforeA[a].apply(this,arguments)}},getCache:function(e){return caches[e.treeId]},getNextNode:function(e,t){if(!t)return null;var n=e.data.key.children,a=t.parentTId?t.getParentNode():data.getRoot(e);for(var o=0,r=a[n].length-1;o<=r;o++){if(a[n][o]===t){return o==r?null:a[n][o+1]}}return null},getNodeByParam:function(e,t,n,a){if(!t||!n)return null;var o=e.data.key.children;for(var r=0,i=t.length;r<i;r++){if(t[r][n]==a){return t[r]}var s=data.getNodeByParam(e,t[r][o],n,a);if(s)return s}return null},getNodeCache:function(e,t){if(!t)return null;var n=caches[e.treeId].nodes[data.getNodeCacheId(t)];return n?n:null},getNodeName:function(e,t){var n=e.data.key.name;return""+t[n]},getNodeTitle:function(e,t){var n=e.data.key.title===""?e.data.key.name:e.data.key.title;return""+t[n]},getNodes:function(e){return data.getRoot(e)[e.data.key.children]},getNodesByParam:function(e,t,n,a){if(!t||!n)return[];var o=e.data.key.children,r=[];for(var i=0,s=t.length;i<s;i++){if(t[i][n]==a){r.push(t[i])}r=r.concat(data.getNodesByParam(e,t[i][o],n,a))}return r},getNodesByParamFuzzy:function(e,t,n,a){if(!t||!n)return[];var o=e.data.key.children,r=[];a=a.toLowerCase();for(var i=0,s=t.length;i<s;i++){if(typeof t[i][n]=="string"&&t[i][n].toLowerCase().indexOf(a)>-1){r.push(t[i])}r=r.concat(data.getNodesByParamFuzzy(e,t[i][o],n,a))}return r},getNodesByFilter:function(e,t,n,a,o){if(!t)return a?null:[];var r=e.data.key.children,i=a?null:[];for(var s=0,l=t.length;s<l;s++){if(tools.apply(n,[t[s],o],false)){if(a){return t[s]}i.push(t[s])}var d=data.getNodesByFilter(e,t[s][r],n,a,o);if(a&&!!d){return d}i=a?d:i.concat(d)}return i},getPreNode:function(e,t){if(!t)return null;var n=e.data.key.children,a=t.parentTId?t.getParentNode():data.getRoot(e);for(var o=0,r=a[n].length;o<r;o++){if(a[n][o]===t){return o==0?null:a[n][o-1]}}return null},getRoot:function(e){return e?roots[e.treeId]:null},getRoots:function(){return roots},getSetting:function(e){return settings[e]},getSettings:function(){return settings},getZTreeTools:function(e){var t=this.getRoot(this.getSetting(e));return t?t.treeTools:null},initCache:function(e){for(var t=0,n=_init.caches.length;t<n;t++){_init.caches[t].apply(this,arguments)}},initNode:function(e,t,n,a,o,r){for(var i=0,s=_init.nodes.length;i<s;i++){_init.nodes[i].apply(this,arguments)}},initRoot:function(e){for(var t=0,n=_init.roots.length;t<n;t++){_init.roots[t].apply(this,arguments)}},isSelectedNode:function(e,t){var n=data.getRoot(e);for(var a=0,o=n.curSelectedList.length;a<o;a++){if(t===n.curSelectedList[a])return true}return false},removeNodeCache:function(e,t){var n=e.data.key.children;if(t[n]){for(var a=0,o=t[n].length;a<o;a++){arguments.callee(e,t[n][a])}}data.getCache(e).nodes[data.getNodeCacheId(t.tId)]=null},removeSelectedNode:function(e,t){var n=data.getRoot(e);for(var a=0,o=n.curSelectedList.length;a<o;a++){if(t===n.curSelectedList[a]||!data.getNodeCache(e,n.curSelectedList[a].tId)){n.curSelectedList.splice(a,1);a--;o--}}},setCache:function(e,t){caches[e.treeId]=t},setRoot:function(e,t){roots[e.treeId]=t},setZTreeTools:function(e,t){for(var n=0,a=_init.zTreeTools.length;n<a;n++){_init.zTreeTools[n].apply(this,arguments)}},transformToArrayFormat:function(e,t){if(!t)return[];var n=e.data.key.children,a=[];if(tools.isArray(t)){for(var o=0,r=t.length;o<r;o++){a.push(t[o]);if(t[o][n])a=a.concat(data.transformToArrayFormat(e,t[o][n]))}}else{a.push(t);if(t[n])a=a.concat(data.transformToArrayFormat(e,t[n]))}return a},transformTozTreeFormat:function(e,t){var n,a,o=e.data.simpleData.idKey,r=e.data.simpleData.pIdKey,i=e.data.key.children;if(!o||o==""||!t)return[];if(tools.isArray(t)){var s=[];var l=[];for(n=0,a=t.length;n<a;n++){l[t[n][o]]=t[n]}for(n=0,a=t.length;n<a;n++){if(l[t[n][r]]&&t[n][o]!=t[n][r]){if(!l[t[n][r]][i])l[t[n][r]][i]=[];l[t[n][r]][i].push(t[n])}else{s.push(t[n])}}return s}else{return[t]}}},event={bindEvent:function(e){for(var t=0,n=_init.bind.length;t<n;t++){_init.bind[t].apply(this,arguments)}},unbindEvent:function(e){for(var t=0,n=_init.unbind.length;t<n;t++){_init.unbind[t].apply(this,arguments)}},bindTree:function(e){var t={treeId:e.treeId},n=e.treeObj;if(!e.view.txtSelectedEnable){n.bind("selectstart",function(e){var t;var n=e.originalEvent.srcElement.nodeName.toLowerCase();return n==="input"||n==="textarea"}).css({"-moz-user-select":"-moz-none"})}n.bind("click",t,event.proxy);n.bind("dblclick",t,event.proxy);n.bind("mouseover",t,event.proxy);n.bind("mouseout",t,event.proxy);n.bind("mousedown",t,event.proxy);n.bind("mouseup",t,event.proxy);n.bind("contextmenu",t,event.proxy)},unbindTree:function(e){var t=e.treeObj;t.unbind("click",event.proxy).unbind("dblclick",event.proxy).unbind("mouseover",event.proxy).unbind("mouseout",event.proxy).unbind("mousedown",event.proxy).unbind("mouseup",event.proxy).unbind("contextmenu",event.proxy)},doProxy:function(e){var t=[];for(var n=0,a=_init.proxys.length;n<a;n++){var o=_init.proxys[n].apply(this,arguments);t.push(o);if(o.stop){break}}return t},proxy:function(e){var t=data.getSetting(e.data.treeId);if(!tools.uCanDo(t,e))return true;var n=event.doProxy(e),a=true,o=false;for(var r=0,i=n.length;r<i;r++){var s=n[r];if(s.nodeEventCallback){o=true;a=s.nodeEventCallback.apply(s,[e,s.node])&&a}if(s.treeEventCallback){o=true;a=s.treeEventCallback.apply(s,[e,s.node])&&a}}return a}},handler={onSwitchNode:function(e,t){var n=data.getSetting(e.data.treeId);if(t.open){if(tools.apply(n.callback.beforeCollapse,[n.treeId,t],true)==false)return true;data.getRoot(n).expandTriggerFlag=true;view.switchNode(n,t)}else{if(tools.apply(n.callback.beforeExpand,[n.treeId,t],true)==false)return true;data.getRoot(n).expandTriggerFlag=true;view.switchNode(n,t)}return true},onClickNode:function(e,t){var n=data.getSetting(e.data.treeId),a=n.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&data.isSelectedNode(n,t)?0:n.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&n.view.selectedMulti?2:1;if(tools.apply(n.callback.beforeClick,[n.treeId,t,a],true)==false)return true;if(a===0){view.cancelPreSelectedNode(n,t)}else{view.selectNode(n,t,a===2)}n.treeObj.trigger(consts.event.CLICK,[e,n.treeId,t,a]);return true},onZTreeMousedown:function(e,t){var n=data.getSetting(e.data.treeId);if(tools.apply(n.callback.beforeMouseDown,[n.treeId,t],true)){tools.apply(n.callback.onMouseDown,[e,n.treeId,t])}return true},onZTreeMouseup:function(e,t){var n=data.getSetting(e.data.treeId);if(tools.apply(n.callback.beforeMouseUp,[n.treeId,t],true)){tools.apply(n.callback.onMouseUp,[e,n.treeId,t])}return true},onZTreeDblclick:function(e,t){var n=data.getSetting(e.data.treeId);if(tools.apply(n.callback.beforeDblClick,[n.treeId,t],true)){tools.apply(n.callback.onDblClick,[e,n.treeId,t])}return true},onZTreeContextmenu:function(e,t){var n=data.getSetting(e.data.treeId);if(tools.apply(n.callback.beforeRightClick,[n.treeId,t],true)){tools.apply(n.callback.onRightClick,[e,n.treeId,t])}return typeof n.callback.onRightClick!="function"}},tools={apply:function(e,t,n){if(typeof e=="function"){return e.apply(zt,t?t:[])}return n},canAsync:function(e,t){var n=e.data.key.children;return e.async.enable&&t&&t.isParent&&!(t.zAsync||t[n]&&t[n].length>0)},clone:function(e){if(e===null)return null;var t=tools.isArray(e)?[]:{};for(var n in e){t[n]=e[n]instanceof Date?new Date(e[n].getTime()):typeof e[n]==="object"?arguments.callee(e[n]):e[n]}return t},eqs:function(e,t){return e.toLowerCase()===t.toLowerCase()},isArray:function(e){return Object.prototype.toString.apply(e)==="[object Array]"},$:function(e,t,n){if(!!t&&typeof t!="string"){n=t;t=""}if(typeof e=="string"){return $(e,n?n.treeObj.get(0).ownerDocument:null)}else{return $("#"+e.tId+t,n?n.treeObj:null)}},getMDom:function(e,t,n){if(!t)return null;while(t&&t.id!==e.treeId){for(var a=0,o=n.length;t.tagName&&a<o;a++){if(tools.eqs(t.tagName,n[a].tagName)&&t.getAttribute(n[a].attrName)!==null){return t}}t=t.parentNode}return null},getNodeMainDom:function(e){return $(e).parent("li").get(0)||$(e).parentsUntil("li").parent().get(0)},isChildOrSelf:function(e,t){return $(e).closest("#"+t).length>0},uCanDo:function(e,t){return true}},view={addNodes:function(e,t,n,a){if(e.data.keep.leaf&&t&&!t.isParent){return}if(!tools.isArray(n)){n=[n]}if(e.data.simpleData.enable){n=data.transformTozTreeFormat(e,n)}if(t){var o=$$(t,consts.id.SWITCH,e),r=$$(t,consts.id.ICON,e),i=$$(t,consts.id.UL,e);if(!t.open){view.replaceSwitchClass(t,o,consts.folder.CLOSE);view.replaceIcoClass(t,r,consts.folder.CLOSE);t.open=false;i.css({display:"none"})}data.addNodesData(e,t,n);view.createNodes(e,t.level+1,n,t);if(!a){view.expandCollapseParentNode(e,t,true)}}else{data.addNodesData(e,data.getRoot(e),n);view.createNodes(e,0,n,null)}},appendNodes:function(e,t,n,a,o,r){if(!n)return[];var i=[],s=e.data.key.children;for(var l=0,d=n.length;l<d;l++){var c=n[l];if(o){var u=a?a:data.getRoot(e),f=u[s],p=f.length==n.length&&l==0,g=l==n.length-1;data.initNode(e,t,c,a,p,g,r);data.addNodeCache(e,c)}var v=[];if(c[s]&&c[s].length>0){v=view.appendNodes(e,t+1,c[s],c,o,r&&c.open)}if(r){view.makeDOMNodeMainBefore(i,e,c);view.makeDOMNodeLine(i,e,c);data.getBeforeA(e,c,i);view.makeDOMNodeNameBefore(i,e,c);data.getInnerBeforeA(e,c,i);view.makeDOMNodeIcon(i,e,c);data.getInnerAfterA(e,c,i);view.makeDOMNodeNameAfter(i,e,c);data.getAfterA(e,c,i);if(c.isParent&&c.open){view.makeUlHtml(e,c,i,v.join(""))}view.makeDOMNodeMainAfter(i,e,c);data.addCreatedNode(e,c)}}return i},appendParentULDom:function(e,t){var n=[],a=$$(t,e);if(!a.get(0)&&!!t.parentTId){view.appendParentULDom(e,t.getParentNode());a=$$(t,e)}var o=$$(t,consts.id.UL,e);if(o.get(0)){o.remove()}var r=e.data.key.children,i=view.appendNodes(e,t.level+1,t[r],t,false,true);view.makeUlHtml(e,t,n,i.join(""));a.append(n.join(""))},asyncNode:function(setting,node,isSilent,callback){var i,l;if(node&&!node.isParent){tools.apply(callback);return false}else if(node&&node.isAjaxing){return false}else if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==false){tools.apply(callback);return false}if(node){node.isAjaxing=true;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"","class":consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={};for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0]}tmpParam[spKey]=node[pKey]}if(tools.isArray(setting.async.otherParam)){for(i=0,l=setting.async.otherParam.length;i<l;i+=2){tmpParam[setting.async.otherParam[i]]=setting.async.otherParam[i+1]}}else{for(var p in setting.async.otherParam){tmpParam[p]=setting.async.otherParam[p]}}var _tmpV=data.getRoot(setting)._ver;$.ajax({contentType:setting.async.contentType,cache:false,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:tmpParam,dataType:setting.async.dataType,success:function(msg){if(_tmpV!=data.getRoot(setting)._ver){return}var newNodes=[];try{if(!msg||msg.length==0){newNodes=[]}else if(typeof msg=="string"){newNodes=eval("("+msg+")")}else{newNodes=msg}}catch(err){newNodes=msg}if(node){node.isAjaxing=null;node.zAsync=true}view.setNodeLineIcos(setting,node);if(newNodes&&newNodes!==""){newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes);view.addNodes(setting,node,!!newNodes?tools.clone(newNodes):[],!!isSilent)}else{view.addNodes(setting,node,[],!!isSilent)}setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]);tools.apply(callback)},error:function(e,t,n){if(_tmpV!=data.getRoot(setting)._ver){return}if(node)node.isAjaxing=null;view.setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,e,t,n])}});return true},cancelPreSelectedNode:function(e,t){var n=data.getRoot(e).curSelectedList;for(var a=0,o=n.length-1;o>=a;o--){if(!t||t===n[o]){$$(n[o],consts.id.A,e).removeClass(consts.node.CURSELECTED);if(t){data.removeSelectedNode(e,t);break}}}if(!t)data.getRoot(e).curSelectedList=[]},createNodeCallback:function(e){if(!!e.callback.onNodeCreated||!!e.view.addDiyDom){var t=data.getRoot(e);while(t.createdNodes.length>0){var n=t.createdNodes.shift();tools.apply(e.view.addDiyDom,[e.treeId,n]);if(!!e.callback.onNodeCreated){e.treeObj.trigger(consts.event.NODECREATED,[e.treeId,n])}}}},createNodes:function(e,t,n,a){if(!n||n.length==0)return;var o=data.getRoot(e),r=e.data.key.children,i=!a||a.open||!!$$(a[r][0],e).get(0);o.createdNodes=[];var s=view.appendNodes(e,t,n,a,true,i);if(!a){e.treeObj.append(s.join(""))}else{var l=$$(a,consts.id.UL,e);if(l.get(0)){l.append(s.join(""))}}view.createNodeCallback(e)},destroy:function(e){if(!e)return;data.initCache(e);data.initRoot(e);event.unbindTree(e);event.unbindEvent(e);e.treeObj.empty();delete settings[e.treeId]},expandCollapseNode:function(e,t,n,a,o){var r=data.getRoot(e),i=e.data.key.children;if(!t){tools.apply(o,[]);return}if(r.expandTriggerFlag){var s=o;o=function(){if(s)s();if(t.open){e.treeObj.trigger(consts.event.EXPAND,[e.treeId,t])}else{e.treeObj.trigger(consts.event.COLLAPSE,[e.treeId,t])}};r.expandTriggerFlag=false}if(!t.open&&t.isParent&&(!$$(t,consts.id.UL,e).get(0)||t[i]&&t[i].length>0&&!$$(t[i][0],e).get(0))){view.appendParentULDom(e,t);view.createNodeCallback(e)}if(t.open==n){tools.apply(o,[]);return}var l=$$(t,consts.id.UL,e),d=$$(t,consts.id.SWITCH,e),c=$$(t,consts.id.ICON,e);if(t.isParent){t.open=!t.open;if(t.iconOpen&&t.iconClose){c.attr("style",view.makeNodeIcoStyle(e,t))}if(t.open){view.replaceSwitchClass(t,d,consts.folder.OPEN);view.replaceIcoClass(t,c,consts.folder.OPEN);if(a==false||e.view.expandSpeed==""){l.show();tools.apply(o,[])}else{if(t[i]&&t[i].length>0){l.slideDown(e.view.expandSpeed,o)}else{l.show();tools.apply(o,[])}}}else{view.replaceSwitchClass(t,d,consts.folder.CLOSE);view.replaceIcoClass(t,c,consts.folder.CLOSE);if(a==false||e.view.expandSpeed==""||!(t[i]&&t[i].length>0)){l.hide();tools.apply(o,[])}else{l.slideUp(e.view.expandSpeed,o)}}}else{tools.apply(o,[])}},expandCollapseParentNode:function(e,t,n,a,o){if(!t)return;if(!t.parentTId){view.expandCollapseNode(e,t,n,a,o);return}else{view.expandCollapseNode(e,t,n,a)}if(t.parentTId){view.expandCollapseParentNode(e,t.getParentNode(),n,a,o)}},expandCollapseSonNode:function(e,t,n,a,o){var r=data.getRoot(e),i=e.data.key.children,s=t?t[i]:r[i],l=t?false:a,d=data.getRoot(e).expandTriggerFlag;data.getRoot(e).expandTriggerFlag=false;if(s){for(var c=0,u=s.length;c<u;c++){if(s[c])view.expandCollapseSonNode(e,s[c],n,l)}}data.getRoot(e).expandTriggerFlag=d;view.expandCollapseNode(e,t,n,a,o)},makeDOMNodeIcon:function(e,t,n){var a=data.getNodeName(t,n),o=t.view.nameIsHTML?a:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e.push("<span id='",n.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(t,n),"' style='",view.makeNodeIcoStyle(t,n),"'></span><span id='",n.tId,consts.id.SPAN,"'>",o,"</span>")},makeDOMNodeLine:function(e,t,n){e.push("<span id='",n.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(t,n),"' treeNode",consts.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(e,t,n){e.push("</li>")},makeDOMNodeMainBefore:function(e,t,n){e.push("<li id='",n.tId,"' class='",consts.className.LEVEL,n.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(e,t,n){e.push("</a>")},makeDOMNodeNameBefore:function(e,t,n){var a=data.getNodeTitle(t,n),o=view.makeNodeUrl(t,n),r=view.makeNodeFontCss(t,n),i=[];for(var s in r){i.push(s,":",r[s],";")}e.push("<a id='",n.tId,consts.id.A,"' class='",consts.className.LEVEL,n.level,"' treeNode",consts.id.A,' onclick="',n.click||"",'" ',o!=null&&o.length>0?"href='"+o+"'":""," target='",view.makeNodeTarget(n),"' style='",i.join(""),"'");if(tools.apply(t.view.showTitle,[t.treeId,n],t.view.showTitle)&&a){e.push("title='",a.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'")}e.push(">")},makeNodeFontCss:function(e,t){var n=tools.apply(e.view.fontCss,[e.treeId,t],e.view.fontCss);return n&&typeof n!="function"?n:{}},makeNodeIcoClass:function(e,t){var n=["ico"];if(!t.isAjaxing){n[0]=(t.iconSkin?t.iconSkin+"_":"")+n[0];if(t.isParent){n.push(t.open?consts.folder.OPEN:consts.folder.CLOSE)}else{n.push(consts.folder.DOCU)}}return t.iconSkin?n.join("_"):consts.className.BUTTON+" "+n.join("_")},makeNodeIcoStyle:function(e,t){var n=[];if(!t.isAjaxing){var a=t.isParent&&t.iconOpen&&t.iconClose?t.open?t.iconOpen:t.iconClose:t.icon;if(a)n.push("background:url(",a,") 0 0 no-repeat;");if(e.view.showIcon==false||!tools.apply(e.view.showIcon,[e.treeId,t],true)){n.push("width:0px;height:0px;")}}return n.join("")},makeNodeLineClass:function(e,t){var n=[];if(e.view.showLine){if(t.level==0&&t.isFirstNode&&t.isLastNode){n.push(consts.line.ROOT)}else if(t.level==0&&t.isFirstNode){n.push(consts.line.ROOTS)}else if(t.isLastNode){n.push(consts.line.BOTTOM)}else{n.push(consts.line.CENTER)}}else{n.push(consts.line.NOLINE)}if(t.isParent){n.push(t.open?consts.folder.OPEN:consts.folder.CLOSE)}else{n.push(consts.folder.DOCU)}return view.makeNodeLineClassEx(t)+n.join("_")},makeNodeLineClassEx:function(e){return consts.className.BUTTON+" "+consts.className.LEVEL+e.level+" "+consts.className.SWITCH+" "},makeNodeTarget:function(e){return e.target||"_blank"},makeNodeUrl:function(e,t){var n=e.data.key.url;return t[n]?t[n]:null},makeUlHtml:function(e,t,n,a){n.push("<ul id='",t.tId,consts.id.UL,"' class='",consts.className.LEVEL,t.level," ",view.makeUlLineClass(e,t),"' style='display:",t.open?"block":"none","'>");n.push(a);n.push("</ul>")},makeUlLineClass:function(e,t){return e.view.showLine&&!t.isLastNode?consts.line.LINE:""},removeChildNodes:function(e,t){if(!t)return;var n=e.data.key.children,a=t[n];if(!a)return;for(var o=0,r=a.length;o<r;o++){data.removeNodeCache(e,a[o])}data.removeSelectedNode(e);delete t[n];if(!e.data.keep.parent){t.isParent=false;t.open=false;var i=$$(t,consts.id.SWITCH,e),s=$$(t,consts.id.ICON,e);view.replaceSwitchClass(t,i,consts.folder.DOCU);view.replaceIcoClass(t,s,consts.folder.DOCU);$$(t,consts.id.UL,e).remove()}else{$$(t,consts.id.UL,e).empty()}},setFirstNode:function(e,t){var n=e.data.key.children,a=t[n].length;if(a>0){t[n][0].isFirstNode=true}},setLastNode:function(e,t){var n=e.data.key.children,a=t[n].length;if(a>0){t[n][a-1].isLastNode=true}},removeNode:function(e,t){var n=data.getRoot(e),a=e.data.key.children,o=t.parentTId?t.getParentNode():n;t.isFirstNode=false;t.isLastNode=false;t.getPreNode=function(){return null};t.getNextNode=function(){return null};if(!data.getNodeCache(e,t.tId)){return}$$(t,e).remove();data.removeNodeCache(e,t);data.removeSelectedNode(e,t);for(var r=0,i=o[a].length;r<i;r++){if(o[a][r].tId==t.tId){o[a].splice(r,1);break}}view.setFirstNode(e,o);view.setLastNode(e,o);var s,l,d,c=o[a].length;if(!e.data.keep.parent&&c==0){o.isParent=false;o.open=false;s=$$(o,consts.id.UL,e);l=$$(o,consts.id.SWITCH,e);d=$$(o,consts.id.ICON,e);view.replaceSwitchClass(o,l,consts.folder.DOCU);view.replaceIcoClass(o,d,consts.folder.DOCU);s.css("display","none")}else if(e.view.showLine&&c>0){var u=o[a][c-1];s=$$(u,consts.id.UL,e);l=$$(u,consts.id.SWITCH,e);d=$$(u,consts.id.ICON,e);if(o==n){if(o[a].length==1){view.replaceSwitchClass(u,l,consts.line.ROOT)}else{var f=$$(o[a][0],consts.id.SWITCH,e);view.replaceSwitchClass(o[a][0],f,consts.line.ROOTS);view.replaceSwitchClass(u,l,consts.line.BOTTOM)}}else{view.replaceSwitchClass(u,l,consts.line.BOTTOM)}s.removeClass(consts.line.LINE)}},replaceIcoClass:function(e,t,n){if(!t||e.isAjaxing)return;var a=t.attr("class");if(a==undefined)return;var o=a.split("_");switch(n){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:o[o.length-1]=n;break}t.attr("class",o.join("_"))},replaceSwitchClass:function(e,t,n){if(!t)return;var a=t.attr("class");if(a==undefined)return;var o=a.split("_");switch(n){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:o[0]=view.makeNodeLineClassEx(e)+n;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:o[1]=n;break}t.attr("class",o.join("_"));if(n!==consts.folder.DOCU){t.removeAttr("disabled")}else{t.attr("disabled","disabled")}},selectNode:function(e,t,n){if(!n){view.cancelPreSelectedNode(e)}$$(t,consts.id.A,e).addClass(consts.node.CURSELECTED);data.addSelectedNode(e,t)},setNodeFontCss:function(e,t){var n=$$(t,consts.id.A,e),a=view.makeNodeFontCss(e,t);if(a){n.css(a)}},setNodeLineIcos:function(e,t){if(!t)return;var n=$$(t,consts.id.SWITCH,e),a=$$(t,consts.id.UL,e),o=$$(t,consts.id.ICON,e),r=view.makeUlLineClass(e,t);if(r.length==0){a.removeClass(consts.line.LINE)}else{a.addClass(r)}n.attr("class",view.makeNodeLineClass(e,t));if(t.isParent){n.removeAttr("disabled")}else{n.attr("disabled","disabled")}o.removeAttr("style");o.attr("style",view.makeNodeIcoStyle(e,t));o.attr("class",view.makeNodeIcoClass(e,t))},setNodeName:function(e,t){var n=data.getNodeTitle(e,t),a=$$(t,consts.id.SPAN,e);a.empty();if(e.view.nameIsHTML){a.html(data.getNodeName(e,t))}else{a.text(data.getNodeName(e,t))}if(tools.apply(e.view.showTitle,[e.treeId,t],e.view.showTitle)){var o=$$(t,consts.id.A,e);o.attr("title",!n?"":n)}},setNodeTarget:function(e,t){var n=$$(t,consts.id.A,e);n.attr("target",view.makeNodeTarget(t))},setNodeUrl:function(e,t){var n=$$(t,consts.id.A,e),a=view.makeNodeUrl(e,t);if(a==null||a.length==0){n.removeAttr("href")}else{n.attr("href",a)}},switchNode:function(e,t){if(t.open||!tools.canAsync(e,t)){view.expandCollapseNode(e,t,!t.open)}else if(e.async.enable){if(!view.asyncNode(e,t)){view.expandCollapseNode(e,t,!t.open);return}}else if(t){view.expandCollapseNode(e,t,!t.open)}}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(e){var t=data.getZTreeTools(e);return t?t:null},destroy:function(e){if(!!e&&e.length>0){view.destroy(data.getSetting(e))}else{for(var t in settings){view.destroy(settings[t])}}},init:function(e,t,n){var a=tools.clone(_setting);$.extend(true,a,t);a.treeId=e.attr("id");a.treeObj=e;a.treeObj.empty();settings[a.treeId]=a;if(typeof document.body.style.maxHeight==="undefined"){a.view.expandSpeed=""}data.initRoot(a);var o=data.getRoot(a),r=a.data.key.children;n=n?tools.clone(tools.isArray(n)?n:[n]):[];if(a.data.simpleData.enable){o[r]=data.transformTozTreeFormat(a,n)}else{o[r]=n}data.initCache(a);event.unbindTree(a);event.bindTree(a);event.unbindEvent(a);event.bindEvent(a);var i={setting:a,addNodes:function(e,t,n){if(!t)return null;if(!e)e=null;if(e&&!e.isParent&&a.data.keep.leaf)return null;var o=tools.clone(tools.isArray(t)?t:[t]);function r(){view.addNodes(a,e,o,n==true)}if(tools.canAsync(a,e)){view.asyncNode(a,e,n,r)}else{r()}return o},cancelSelectedNode:function(e){view.cancelPreSelectedNode(a,e)},destroy:function(){view.destroy(a)},expandAll:function(e){e=!!e;view.expandCollapseSonNode(a,null,e,true);return e},expandNode:function(e,t,n,o,r){if(!e||!e.isParent)return null;if(t!==true&&t!==false){t=!e.open}r=!!r;if(r&&t&&tools.apply(a.callback.beforeExpand,[a.treeId,e],true)==false){return null}else if(r&&!t&&tools.apply(a.callback.beforeCollapse,[a.treeId,e],true)==false){return null}if(t&&e.parentTId){view.expandCollapseParentNode(a,e.getParentNode(),t,false)}if(t===e.open&&!n){return null}data.getRoot(a).expandTriggerFlag=r;if(!tools.canAsync(a,e)&&n){view.expandCollapseSonNode(a,e,t,true,function(){if(o!==false){try{$$(e,a).focus().blur()}catch(t){}}})}else{e.open=!t;view.switchNode(this.setting,e);if(o!==false){try{$$(e,a).focus().blur()}catch(i){}}}return t},getNodes:function(){return data.getNodes(a)},getNodeByParam:function(e,t,n){if(!e)return null;return data.getNodeByParam(a,n?n[a.data.key.children]:data.getNodes(a),e,t)},getNodeByTId:function(e){return data.getNodeCache(a,e)},getNodesByParam:function(e,t,n){if(!e)return null;return data.getNodesByParam(a,n?n[a.data.key.children]:data.getNodes(a),e,t)},getNodesByParamFuzzy:function(e,t,n){if(!e)return null;return data.getNodesByParamFuzzy(a,n?n[a.data.key.children]:data.getNodes(a),e,t)},getNodesByFilter:function(e,t,n,o){t=!!t;if(!e||typeof e!="function")return t?null:[];return data.getNodesByFilter(a,n?n[a.data.key.children]:data.getNodes(a),e,t,o)},getNodeIndex:function(e){if(!e)return null;var t=a.data.key.children,n=e.parentTId?e.getParentNode():data.getRoot(a);for(var o=0,r=n[t].length;o<r;o++){if(n[t][o]==e)return o}return-1},getSelectedNodes:function(){var e=[],t=data.getRoot(a).curSelectedList;for(var n=0,o=t.length;n<o;n++){e.push(t[n])}return e},isSelectedNode:function(e){return data.isSelectedNode(a,e)},reAsyncChildNodes:function(e,t,n){if(!this.setting.async.enable)return;var o=!e;if(o){e=data.getRoot(a)}if(t=="refresh"){var r=this.setting.data.key.children;for(var i=0,s=e[r]?e[r].length:0;i<s;i++){data.removeNodeCache(a,e[r][i])}data.removeSelectedNode(a);e[r]=[];if(o){this.setting.treeObj.empty()}else{var l=$$(e,consts.id.UL,a);l.empty()}}view.asyncNode(this.setting,o?null:e,!!n)},refresh:function(){this.setting.treeObj.empty();var e=data.getRoot(a),t=e[a.data.key.children];data.initRoot(a);e[a.data.key.children]=t;data.initCache(a);view.createNodes(a,0,e[a.data.key.children])},removeChildNodes:function(e){
if(!e)return null;var t=a.data.key.children,n=e[t];view.removeChildNodes(a,e);return n?n:null},removeNode:function(e,t){if(!e)return;t=!!t;if(t&&tools.apply(a.callback.beforeRemove,[a.treeId,e],true)==false)return;view.removeNode(a,e);if(t){this.setting.treeObj.trigger(consts.event.REMOVE,[a.treeId,e])}},selectNode:function(e,t){if(!e)return;if(tools.uCanDo(a)){t=a.view.selectedMulti&&t;if(e.parentTId){view.expandCollapseParentNode(a,e.getParentNode(),true,false,function(){try{$$(e,a).focus().blur()}catch(t){}})}else{try{$$(e,a).focus().blur()}catch(n){}}view.selectNode(a,e,t)}},transformTozTreeNodes:function(e){return data.transformTozTreeFormat(a,e)},transformToArray:function(e){return data.transformToArrayFormat(a,e)},updateNode:function(e,t){if(!e)return;var n=$$(e,a);if(n.get(0)&&tools.uCanDo(a)){view.setNodeName(a,e);view.setNodeTarget(a,e);view.setNodeUrl(a,e);view.setNodeLineIcos(a,e);view.setNodeFontCss(a,e)}}};o.treeTools=i;data.setZTreeTools(a,i);if(o[r]&&o[r].length>0){view.createNodes(a,0,o[r])}else if(a.async.enable&&a.async.url&&a.async.url!==""){view.asyncNode(a)}return i}};var zt=$.fn.zTree,$$=tools.$,consts=zt.consts})(jQuery);