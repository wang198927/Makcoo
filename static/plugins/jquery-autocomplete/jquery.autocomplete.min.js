(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"&&typeof require==="function"){e(require("jquery"))}else{e(jQuery)}})(function(e){"use strict";var t=function(){return{escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");t.className=e;t.style.position="absolute";t.style.display="none";return t}}}(),n={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};function i(t,n){var s=function(){},o=this,r={ajaxSettings:{},autoSelectFirst:false,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,onSelectChange:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:i.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:false,onSearchStart:s,onSearchComplete:s,onSearchError:s,preserveInput:false,containerClass:"autocomplete-suggestions",tabDisabled:false,dataType:"text",currentRequest:null,triggerSelectOnValidInput:true,preventBadQueries:true,lookupFilter:function(e,t,n){return e.value.toLowerCase().indexOf(n)!==-1},paramName:"query",transformResult:function(t){return typeof t==="string"?e.parseJSON(t):t},showNoSuggestionNotice:false,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:false};o.element=t;o.el=e(t);o.suggestions=[];o.badQueries=[];o.selectedIndex=-1;o.currentValue=o.element.value;o.intervalId=0;o.cachedResponse={};o.onChangeInterval=null;o.onChange=null;o.isLocal=false;o.suggestionsContainer=null;o.noSuggestionsContainer=null;o.options=e.extend({},r,n);o.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"};o.hint=null;o.hintValue="";o.selection=null;o.initialize();o.setOptions(n)}i.utils=t;e.Autocomplete=i;i.formatResult=function(e,n){var i=e.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");var s="("+t.escapeRegExChars(n)+")";return i.replace(new RegExp(s,"gi"),"<strong>$1</strong>")};i.prototype={killerFn:null,initialize:function(){var t=this,n="."+t.classes.suggestion,s=t.classes.selected,o=t.options,r;t.element.setAttribute("autocomplete","off");t.killerFn=function(n){if(e(n.target).closest("."+t.options.containerClass).length===0){t.killSuggestions();t.disableKillerFn()}};t.noSuggestionsContainer=e('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0);t.suggestionsContainer=i.utils.createNode(o.containerClass);r=e(t.suggestionsContainer);r.appendTo(o.appendTo);if(o.width!=="auto"){r.width(o.width)}r.on("mouseover.autocomplete",n,function(){t.activate(e(this).data("index"))});r.on("mouseout.autocomplete",function(){t.selectedIndex=-1;r.children("."+s).removeClass(s)});r.on("click.autocomplete",n,function(){t.select(e(this).data("index"))});t.fixPositionCapture=function(){if(t.visible){t.fixPosition()}};e(window).on("resize.autocomplete",t.fixPositionCapture);t.el.on("keydown.autocomplete",function(e){t.onKeyPress(e)});t.el.on("keyup.autocomplete",function(e){t.onKeyUp(e)});t.el.on("blur.autocomplete",function(){t.onBlur()});t.el.on("focus.autocomplete",function(){t.onFocus()});t.el.on("change.autocomplete",function(e){t.onKeyUp(e)});t.el.on("input.autocomplete",function(e){t.onKeyUp(e)})},onFocus:function(){var e=this;e.fixPosition();if(e.options.minChars<=e.el.val().length){e.onValueChange()}},onBlur:function(){this.enableKillerFn()},setOptions:function(t){var n=this,i=n.options;e.extend(i,t);n.isLocal=e.isArray(i.lookup);if(n.isLocal){i.lookup=n.verifySuggestionsFormat(i.lookup)}i.orientation=n.validateOrientation(i.orientation,"bottom");e(n.suggestionsContainer).css({"max-height":i.maxHeight+"px",width:i.width+"px","z-index":i.zIndex})},clearCache:function(){this.cachedResponse={};this.badQueries=[]},clear:function(){this.clearCache();this.currentValue="";this.suggestions=[]},disable:function(){var e=this;e.disabled=true;clearInterval(e.onChangeInterval);if(e.currentRequest){e.currentRequest.abort()}},enable:function(){this.disabled=false},fixPosition:function(){var t=this,n=e(t.suggestionsContainer),i=n.parent().get(0);if(i!==document.body&&!t.options.forceFixPosition){return}var s=t.options.orientation,o=n.outerHeight(),r=t.el.outerHeight(),a=t.el.offset(),l={top:a.top,left:a.left};if(s==="auto"){var u=e(window).height(),c=e(window).scrollTop(),g=-c+a.top-o,f=c+u-(a.top+r+o);s=Math.max(g,f)===g?"top":"bottom"}if(s==="top"){l.top+=-o}else{l.top+=r}if(i!==document.body){var d=n.css("opacity"),p;if(!t.visible){n.css("opacity",0).show()}p=n.offsetParent().offset();l.top-=p.top;l.left-=p.left;if(!t.visible){n.css("opacity",d).hide()}}if(t.options.width==="auto"){l.width=t.el.outerWidth()-2+"px"}n.css(l)},enableKillerFn:function(){var t=this;e(document).on("click.autocomplete",t.killerFn)},disableKillerFn:function(){var t=this;e(document).off("click.autocomplete",t.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions();e.intervalId=window.setInterval(function(){e.hide();e.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var e=this,t=e.el.val().length,n=e.element.selectionStart,i;if(typeof n==="number"){return n===t}if(document.selection){i=document.selection.createRange();i.moveStart("character",-t);return t===i.text.length}return true},onKeyPress:function(e){var t=this;if(!t.disabled&&!t.visible&&e.which===n.DOWN&&t.currentValue){t.suggest();return}if(t.disabled||!t.visible){return}switch(e.which){case n.ESC:t.el.val(t.currentValue);t.hide();break;case n.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case n.TAB:if(t.hint&&t.options.onHint){t.selectHint();return}if(t.selectedIndex===-1){t.hide();return}t.select(t.selectedIndex);if(t.options.tabDisabled===false){return}break;case n.RETURN:if(t.selectedIndex===-1){t.hide();return}t.select(t.selectedIndex);break;case n.UP:t.moveUp();break;case n.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation();e.preventDefault()},onKeyUp:function(e){var t=this;if(t.disabled){return}switch(e.which){case n.UP:case n.DOWN:return}clearInterval(t.onChangeInterval);if(t.currentValue!==t.el.val()){t.findBestHint();if(t.options.deferRequestBy>0){t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy)}else{t.onValueChange()}}},onValueChange:function(){var t=this,n=t.options,i=t.el.val(),s=t.getQuery(i),o;if(t.selection&&t.currentValue!==s){t.selection=null;(n.onInvalidateSelection||e.noop).call(t.element)}clearInterval(t.onChangeInterval);t.currentValue=i;t.selectedIndex=-1;if(n.triggerSelectOnValidInput){o=t.findSuggestionIndex(s);if(o!==-1){t.select(o);return}}if(s.length<n.minChars){t.hide()}else{t.getSuggestions(s)}},findSuggestionIndex:function(t){var n=this,i=-1,s=t.toLowerCase();e.each(n.suggestions,function(e,t){if(t.value.toLowerCase()===s){i=e;return false}});return i},getQuery:function(t){var n=this.options.delimiter,i;if(!n){return t}i=t.split(n);return e.trim(i[i.length-1])},getSuggestionsLocal:function(t){var n=this,i=n.options,s=t.toLowerCase(),o=i.lookupFilter,r=parseInt(i.lookupLimit,10),a;a={suggestions:e.grep(i.lookup,function(e){return o(e,t,s)})};if(r&&a.suggestions.length>r){a.suggestions=a.suggestions.slice(0,r)}return a},getSuggestions:function(t){var n,i=this,s=i.options,o=s.serviceUrl,r,a,l;s.params[s.paramName]=t;r=s.ignoreParams?null:s.params;if(s.onSearchStart.call(i.element,s.params)===false){return}if(e.isFunction(s.lookup)){s.lookup(t,function(e){i.suggestions=e.suggestions;i.suggest();s.onSearchComplete.call(i.element,t,e.suggestions)});return}if(i.isLocal){n=i.getSuggestionsLocal(t)}else{if(e.isFunction(o)){o=o.call(i.element,t)}a=o+"?"+e.param(r||{});n=i.cachedResponse[a]}if(n&&e.isArray(n.suggestions)){i.suggestions=n.suggestions;i.suggest();s.onSearchComplete.call(i.element,t,n.suggestions)}else if(!i.isBadQuery(t)){if(i.currentRequest){i.currentRequest.abort()}l={url:o,data:r,type:s.type,dataType:s.dataType};e.extend(l,s.ajaxSettings);i.currentRequest=e.ajax(l).done(function(e){var n;i.currentRequest=null;n=s.transformResult(e);i.processResponse(n,t,a);s.onSearchComplete.call(i.element,t,n.suggestions)}).fail(function(e,n,o){s.onSearchError.call(i.element,t,e,n,o)})}else{s.onSearchComplete.call(i.element,t,[])}},isBadQuery:function(e){if(!this.options.preventBadQueries){return false}var t=this.badQueries,n=t.length;while(n--){if(e.indexOf(t[n])===0){return true}}return false},hide:function(){var t=this,n=e(t.suggestionsContainer);if(e.isFunction(t.options.onHide)&&t.visible){t.options.onHide.call(t.element,n)}t.visible=false;t.selectedIndex=-1;clearInterval(t.onChangeInterval);e(t.suggestionsContainer).hide();t.signalHint(null)},suggest:function(){if(this.suggestions.length===0){if(this.options.showNoSuggestionNotice){this.noSuggestions()}else{this.hide()}return}var t=this,n=t.options,i=n.groupBy,s=n.formatResult,o=t.getQuery(t.currentValue),r=t.classes.suggestion,a=t.classes.selected,l=e(t.suggestionsContainer),u=e(t.noSuggestionsContainer),c=n.beforeRender,g="",f,d=function(e,t){var n=e.data[i];if(f===n){return""}f=n;return'<div class="autocomplete-group"><strong>'+f+"</strong></div>"},p;if(n.triggerSelectOnValidInput){p=t.findSuggestionIndex(o);if(p!==-1){t.select(p);return}}e.each(t.suggestions,function(e,t){if(i){g+=d(t,o,e)}g+='<div class="'+r+'" data-index="'+e+'">'+s(t,o)+"</div>"});this.adjustContainerWidth();u.detach();l.html(g);if(e.isFunction(c)){c.call(t.element,l)}t.fixPosition();l.show();if(n.autoSelectFirst){t.selectedIndex=0;l.scrollTop(0);l.children("."+r).first().addClass(a)}t.visible=true;t.findBestHint()},noSuggestions:function(){var t=this,n=e(t.suggestionsContainer),i=e(t.noSuggestionsContainer);this.adjustContainerWidth();i.detach();n.empty();n.append(i);t.fixPosition();n.show();t.visible=true},adjustContainerWidth:function(){var t=this,n=t.options,i,s=e(t.suggestionsContainer);if(n.width==="auto"){i=t.el.outerWidth()-2;s.width(i>0?i:300)}},findBestHint:function(){var t=this,n=t.el.val().toLowerCase(),i=null;if(!n){return}e.each(t.suggestions,function(e,t){var s=t.value.toLowerCase().indexOf(n)===0;if(s){i=t}return!s});t.signalHint(i)},signalHint:function(t){var n="",i=this;if(t){n=i.currentValue+t.value.substr(i.currentValue.length)}if(i.hintValue!==n){i.hintValue=n;i.hint=t;(this.options.onHint||e.noop)(n)}},verifySuggestionsFormat:function(t){if(t.length&&typeof t[0]==="string"){return e.map(t,function(e){return{value:e,data:null}})}return t},validateOrientation:function(t,n){t=e.trim(t||"").toLowerCase();if(e.inArray(t,["auto","bottom","top"])===-1){t=n}return t},processResponse:function(e,t,n){var i=this,s=i.options;e.suggestions=i.verifySuggestionsFormat(e.suggestions);if(!s.noCache){i.cachedResponse[n]=e;if(s.preventBadQueries&&e.suggestions.length===0){i.badQueries.push(t)}}if(t!==i.getQuery(i.currentValue)){return}i.suggestions=e.suggestions;i.suggest()},activate:function(t){var n=this,i,s=n.classes.selected,o=e(n.suggestionsContainer),r=o.find("."+n.classes.suggestion);o.find("."+s).removeClass(s);n.selectedIndex=t;if(n.selectedIndex!==-1&&r.length>n.selectedIndex){i=r.get(n.selectedIndex);e(i).addClass(s);return i}return null},selectHint:function(){var t=this,n=e.inArray(t.hint,t.suggestions);t.select(n)},select:function(e){var t=this;if(e<t.suggestions.length){t.el.attr("data-value",t.suggestions[e].data)}t.hide();t.onSelect(e)},moveUp:function(){var t=this;if(t.selectedIndex===-1){return}if(t.selectedIndex===0){e(t.suggestionsContainer).children().first().removeClass(t.classes.selected);t.selectedIndex=-1;t.el.val(t.currentValue);t.findBestHint();return}t.adjustScroll(t.selectedIndex-1)},moveDown:function(){var e=this;if(e.selectedIndex===e.suggestions.length-1){return}e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(t){var n=this,i=n.activate(t);if(!i){return}var s,o,r,a=e(i).outerHeight();s=i.offsetTop;o=e(n.suggestionsContainer).scrollTop();r=o+n.options.maxHeight-a;if(s<o){e(n.suggestionsContainer).scrollTop(s)}else if(s>r){e(n.suggestionsContainer).scrollTop(s-n.options.maxHeight+a)}if(!n.options.preserveInput){n.el.val(n.getValue(n.suggestions[t].value))}n.signalHint(null)},onSelect:function(t){var n=this,i=n.options.onSelect,s=n.suggestions[t];n.currentValue=n.getValue(s.value);if(n.currentValue!==n.el.val()&&!n.options.preserveInput){n.el.val(n.currentValue)}n.signalHint(null);n.suggestions=[];n.selection=s;if(e.isFunction(i)){i.call(n.element,s)}},getValue:function(e){var t=this,n=t.options.delimiter,i,s;if(!n){return e}i=t.currentValue;s=i.split(n);if(s.length===1){return e}return i.substr(0,i.length-s[s.length-1].length)+e},dispose:function(){var t=this;t.el.off(".autocomplete").removeData("autocomplete");t.disableKillerFn();e(window).off("resize.autocomplete",t.fixPositionCapture);e(t.suggestionsContainer).remove()}};e.fn.autocomplete=e.fn.devbridgeAutocomplete=function(t,n){var s="autocomplete";if(arguments.length===0){return this.first().data(s)}return this.each(function(){var o=e(this),r=o.data(s);if(typeof t==="string"){if(r&&typeof r[t]==="function"){r[t](n)}}else{if(r&&r.dispose){r.dispose()}r=new i(this,t);o.data(s,r)}})}});